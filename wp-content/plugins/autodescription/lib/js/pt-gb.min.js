'use strict';window.tsfPTGB=function(a){var b='undefined'!=typeof tsfPTL10n&&tsfPTL10n;const{addFilter:c}=wp.hooks,{createElement:d,Fragment:e}=wp.element,{SelectControl:f}=wp.components,{addQueryArgs:g}=wp.url,h=wp.apiFetch,{invoke:i}=lodash,j={per_page:-1,orderby:'id',order:'asc',_fields:'id,name'},k=()=>{if(tsf.hasInput&&Object.keys(b.taxonomies).length){let l=b.taxonomies,m=wp.template('tsf-primary-term-selector'),n={};const o=(D,E)=>E in l[D].i18n&&l[D].i18n[E]||'',p=D=>document.getElementById('autodescription[_primary_term_'+D+']'),q=D=>+p(D).value,r=(D,E)=>p(D).value=+E,s=D=>{let E=document.getElementById('tsf-gutenberg-data-holder');if(!E)return n[D]=!1;let F=m({taxonomy:l[D]});return n[D]=!!a(E).html(F)},t=D=>n[D],u=(D,E)=>{0>E.indexOf(q(D))&&(0 in E?r(D,E[0]):r(D,0))},v=(D,E)=>r(D,E);(()=>{for(let D in l)s(D)})();var w={};class x{constructor(D){this.slug=D,this.reset()}registeredData(){return!!Object.keys(this.data).length}reset(){this.data={}}read(){return this.data}get(D){return D in this.data&&this.data[D]||null}set(D,E){return this.data[D]=E}}const y=D=>w[D]=new x(D),z=D=>w[D]||y(D);class A extends React.Component{constructor(D){super(D),this.state={loading:!0}}componentDidMount(){this.updateData(),this.dsAccess().registeredData()&&this.setState({loading:!1})}componentWillUnmount(){i(this.fetchRequest,['abort']),i(this.addRequest,['abort'])}componentDidUpdate(D){if(this.updateData(),2<this.props.terms.length&&!this.dsAccess().get('availableTerms'))this.fetchTerms();else if(this.props.terms!==D.terms){let F=this.props.terms.filter(G=>-1===D.terms.indexOf(G));F.length&&!this.isTermAvailable(F[0])&&this.fetchTerms()}}updateData(){this.dsAccess().registeredData()||(this.dsAccess().set('availableTerms',[]),this.fetchTerms()),this.dsAccess().set('selectedTerms',this.props.terms)}updateTerms(){this.updateData()}dsAccess(){return z(this.props.slug)}isTermAvailable(D){let E=this.dsAccess().get('availableTerms');return E.some(F=>F.id===D)}fetchTerms(){const{taxonomy:D}=this.props;D&&(this.setState({selectedTerms:this.props.terms,loading:!0}),this.fetchRequest=h({path:g('/wp/v2/'+D.rest_base,j)}),this.fetchRequest.then(E=>{this.fetchRequest=null,this.setState({loading:!1}),this.dsAccess().set('availableTerms',E),this.forceUpdate()},E=>{'abort'===E.statusText||(this.fetchRequest=null,this.setState({loading:!1}),this.forceUpdate())}))}}class B extends A{constructor(D){super(D),this.onChange=this.onChange.bind(this)}getTermName(D){let E=this.dsAccess().get('availableTerms'),F=E.find(G=>G.id===D);return F&&F.name||''}getSelectOptions(){return this.dsAccess().get('selectedTerms').sort().map(D=>{return{value:D,label:this.getTermName(D)}})}onChange(D){this.setState({options:this.getSelectOptions(),value:v(this.props.slug,D)}),tsf.registerChange()}isDisabled(){return!!this.state.loading}render(){return this.updateData(),d(f,{label:o(this.props.slug,'selectPrimary'),value:q(this.props.slug),className:'tsf-pt-gb-selector',onChange:this.onChange,options:this.state.loading?'':this.getSelectOptions(),disabled:this.isDisabled()})}}c('editor.PostTaxonomyType','tsf/pt',D=>class extends A{initSelectors(){const{slug:E,terms:F}=this.props;return t(E)&&(u(E,F),1<F.length)?d(e,{},d(B,this.props)):null}render(){return!this.props.slug in l?void 0:d(e,{},d(D,this.props),this.initSelectors())}},20)}};return a.extend({load:function(){a(document.body).on('tsf-onload',k)}},{})}(jQuery),jQuery(window.tsfPTGB.load);
